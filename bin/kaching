#!/usr/bin/env ruby
# frozen_string_literal: true

require 'bundler/setup'
require 'kaching'

CONFIG_PATH = 'config.json'

raise "Create #{CONFIG_PATH} first" unless File.exist?(CONFIG_PATH)

# @param results [Array(Array(String,Integer))]
# @return [String]
def build_msg(results)
  n = results.map(&:last).sum
  "Sold #{n} #{n == 1 ? 'copy' : 'copies'}"
end

Kaching::Configure.from_json_file(CONFIG_PATH)

apple = Kaching::AppStore.latest_sales_count
puts('App Store', apple)

google = Kaching::GooglePlay.latest_sales_count
puts('Google Play', google)

msg = build_msg([apple, google])

print("\u0007")
`say #{msg}`
